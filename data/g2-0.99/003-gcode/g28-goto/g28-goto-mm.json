################################################################################
#
#  g28-goto-mm.json - test g28/g30 go-to-home in millimeter units mode
#
# include 000-init/init-standard-gcode.json
#
# This file sets up the board to behave as an Othermachine Othermill:
#   X min/max travel                0, 145.6 (mm)
#   Y min/max travel                0, 119.1 (mm)
#   Z min/max travel                -60.1, 0 (mm)
#
#   XYZ maximum velocity            1500 mm/min
#   XYZ maximum jerk                 500 mm/min^3 (* 1,000,000)
#   JT junction integration time    0.75
#
#   Other parameters such as limit enables, motor power, etc. are not changed
#   Motor mapping is assumed to be correct and not messed with.
#
#   Position the head at machine origin or some other unobstructed start position
*   Ensure that clearance from start position is at least (60,60,-30)
#   The origin position will be set to (0,0,0) by the G28.3 command
#
# Set some offsets to test against
{
    "t":{"label":"Set G55 & G56 offsets for testing G28/G30 mm mode",
        "send":["G10 L20 P2 X-40 Y-40 Z20",
                "G10 L20 P3 X-20 Y-20 Z10"]},
    "r":{"status":0}
}
#
# START TESTS
#
# G28 / G54 TEST
#
{
    "t":{"label":"Move to test position in G54 coordinates",
        "before":["G21 G54"],
        "send":["g0 x40 y40 z-20"]},
    "r":{"status":0},
    "sr":{"posx": 40, "posy": 40, "posz": -20}
}
#
{
    "t":{"label":"Save G28 test position",
        "send":["G28.1"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Move to third position",
        "send":["g0 x50 y50 z-25"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Return to G28 test position",
        "send":["G28"]},
    "r":{"status":0},
    "sr":{"posx": 40, "posy": 40, "posz": -20}
}
#
{
    "t":{"label":"Move to third position again",
        "send":["g0 x50 y50 z-25"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Return to G28 test position XY first, then Z",
        "send":["G28 X40 Y40"]},
    "r":{"status":0},
    "sr":{"posx": 40, "posy": 40, "posz": -20}
}
#
# G30 / G54 TEST
#
{
    "t":{"label":"Move to test position in G54 coordinates",
        "before":["G21 G54"],
        "send":["g0 x40 y40 z-20"]},
    "r":{"status":0},
    "sr":{"posx": 40, "posy": 40, "posz": -20}
}
#
{
    "t":{"label":"Save G30 test position",
        "send":["G30.1"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Move to third position",
        "send":["g0 x50 y50 z-25"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Return to G30 test position",
        "send":["G30"]},
    "r":{"status":0},
    "sr":{"posx": 40, "posy": 40, "posz": -20}
}
#
{
    "t":{"label":"Move to third position again",
        "send":["g0 x50 y50 z-25"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Return to G30 test position XY first, then Z",
        "send":["G30 X40 Y40"]},
    "r":{"status":0},
    "sr":{"posx": 40, "posy": 40, "posz": -20}
}
#
# G28 / G55 TEST
#
{
    "t":{"label":"Move to test position in G54 coordinates",
        "before":["G21 G54"],
        "send":["g0 x40 y40 z-20"]},
    "r":{"status":0},
    "sr":{"posx": 40, "posy": 40, "posz": -20}
}
#
{
    "t":{"label":"Save G28 test position",
        "send":["G28.1"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Select G55 - at the saved test position",
        "send":["G55"]},
    "r":{"status":0},
    "sr":{"posx": 0, "posy": 0, "posz": 0}

}
#
{
    "t":{"label":"Move to third position",
        "send":["g0 x10 y10 z-5"]},
    "r":{"status":0},
    "sr":{"posx": 10, "posy": 10, "posz": -5}
}
#
{
    "t":{"label":"Return to G28 test position - in G55 offsets",
        "send":["G28"]},
    "r":{"status":0},
    "sr":{"posx": 0, "posy": 0, "posz": 0}
}
#
# G28 / G56 TEST
#
{
    "t":{"label":"Move to test position in G54 coordinates",
        "before":["G21 G54"],
        "send":["g0 x40 y40 z-20"]},
    "r":{"status":0},
    "sr":{"posx": 40, "posy": 40, "posz": -20}
}
#
{
    "t":{"label":"Save G28 test position in G55 coordinates",
        "send":["G55","G28.1"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Select G56 - at the saved test position",
        "send":["G56"]},
    "r":{"status":0},
    "sr":{"posx": 20, "posy": 20, "posz": -10}

}
#
{
    "t":{"label":"Move to third position",
        "send":["g0 x10 y10 z-5"]},
    "r":{"status":0},
    "sr":{"posx": 10, "posy": 10, "posz": -5}
}
#
{
    "t":{"label":"Return to G28 test position - in G56 offsets",
        "send":["G28"]},
    "r":{"status":0},
    "sr":{"posx": 20, "posy": 20, "posz": -10}
}
