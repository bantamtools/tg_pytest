################################################################################
#
#  g54-coordinate-offsets.json - test G53 - G59 coordinate system functions
#
# Do not run any preamble before this file
#
# This file sets up the board to behave as an Othermachine Othermill:
#   X min/max travel                0, 145.6
#   Y min/max travel                0, 119.1
#   Z min/max travel                -60.1, 0
#
#   XYZ maximum velocity            1500 mm/min
#   XYZ maximum jerk                 500 mm/min^3 (* 1,000,000)
#   JT junction integration time    0.75
#
#   Other parameters such as limit enables, motor power, etc. are not changed
#   Motor mapping is assumed to be correct and not messed with.
#
#   Position the head at machine origin or some other unobstructed start position
*   Ensure that clearance from start position is at least (60,60,-30)
#   The origin position will be set to (0,0,0) by the G28.3 command
#
# L2	 x	     y	      z		      x-mm	    y-mm	 z-mm	   x-in	  y-in	  z-in
# g54	0.0000	 0.0000	  0.0000      0.0000   0.0000	0.0000	   0.0000  0.0000  0.0000
# g55  25.4000	25.4000	-12.7000	-25.4000 -25.4000  12.7000	  -1.0000 -1.0000  0.5000
# g56  20.0000	19.0000	-10.0000	-20.0000 -19.0000  10.0000	  -0.7874 -0.7480  0.3937
# g57  14.0000	14.1000	 -8.7000	-14.0000 -14.1000	8.7000	  -0.5512 -0.5551  0.3425
# g58  12.0000	11.0000	 -6.3000	-12.0000 -11.0000	6.3000	  -0.4724 -0.4331  0.2480
# g59  11.5000	 6.6000	 -4.3000	-11.5000  -6.6000	4.3000	  -0.4528 -0.2598  0.1693
#
# L20	 x	     y	      z		      x-mm	    y-mm	z-mm		 x-in	 y-in	  z-in
# g54	0.0000	 0.0000	  0.0000	  0.0000   0.0000   0.0000	   0.0000  0.0000  0.0000
# g55  25.4000	25.4000	-12.7000	 25.4000  25.4000 -12.7000	   1.0000  1.0000 -0.5000
# g56  20.0000	19.0000	-10.0000	 20.0000  19.0000 -10.0000	   0.7874  0.7480 -0.3937
# g57  14.0000	14.1000	 -8.7000	 14.0000  14.1000  -8.7000	   0.5512  0.5551 -0.3425
# g58  12.0000	11.0000	 -6.3000	 12.0000  11.0000  -6.3000	   0.4724  0.4331 -0.2480
# g59  11.5000	 6.6000	 -4.3000	 11.5000   6.6000  -4.3000	   0.4528  0.2598 -0.1693
#
# include 000-init/init-standard-gcode.json
#
# Override precision default for these tests
{
    "defaults":{
        "precision":0.01
    }
}
#
#### G10 TESTS ###
#
# G10 L2 TESTS
#
{
    "t":{"label":"Set G55 offsets in millimeters",
        "before":["g21 g54","g0 x0 y0 z0"],
        "send":["G10 L2 P2 X25.4 Y25.4 Z-12.7"]},
    "r":{"status":0},
    "sr":{"posx":0, "posy":0, "posz":0}
}
#
{
    "t":{"label":"Read G55 position in mm",
        "send":["G21 G55"]},
    "r":{"status":0},
    "sr":{"posx":-25.4, "posy":-25.4, "posz":12.7}
}
#
{
    "t":{"label":"Read G55 position in inches",
        "send":["G20 G55"]},
    "r":{"status":0},
    "sr":{"posx":-1.0, "posy":-1.0, "posz":0.5}
}
#
{
    "t":{"label":"Set G56 offset in inches",
        "before":["g20 g54","g0 x0 y0 z0"],
        "send":["G10 L2 P3 X0.7874 Y0.748 Z-0.3937"]},
    "r":{"status":0},
    "sr":{"posx":0, "posy":0, "posz":0}
}
#
{
    "t":{"label":"Read G56 position in mm",
        "send":["G21 G56"]},
    "r":{"status":0},
    "sr":{"posx":-20.0, "posy":-19.0, "posz":10.0}
}
#
{
    "t":{"label":"Read G56 position in inches",
        "send":["G20 G56"]},
    "r":{"status":0},
    "sr":{"posx":-0.7874, "posy":-0.748, "posz":0.3937}
}
#
# G10 L20 TESTS
#
{
    "t":{"label":"Set G57 offsets in millimeters",
        "before":["g21 g54","g0 x0 y0 z0"],
        "send":["G10 L20 P4 X14 Y14.1 Z-8.7"]},
    "r":{"status":0},
    "sr":{"posx":0, "posy":0, "posz":0}
}
#
{
    "t":{"label":"Read G57 position in mm",
        "send":["G21 G57"]},
    "r":{"status":0},
    "sr":{"posx":14, "posy":14.1, "posz":-8.7}
}
#
{
    "t":{"label":"Read G57 position in inches",
        "send":["G20 G57"]},
    "r":{"status":0},
    "sr":{"posx":0.5512, "posy":0.5551, "posz":-0.3425}
}
#
{
    "t":{"label":"Set G58 offsets in inches",
        "before":["g20 g54","g0 x0 y0 z0"],
        "send":["G10 L20 P5 X0.4724 Y0.4331 Z-0.2480"]},
    "r":{"status":0},
    "sr":{"posx":0, "posy":0, "posz":0}
}
#
{
    "t":{"label":"Read G58 position in mm",
        "send":["G21 G58"]},
    "r":{"status":0},
    "sr":{"posx":12, "posy":11, "posz":-6.3}
}
#
{
    "t":{"label":"Read G58 position in inches",
        "send":["G20 G58"]},
    "r":{"status":0},
    "sr":{"posx":0.4724, "posy":0.4331, "posz":-0.2480}
}
#
# SET COORDINATE OFFSETS USING JSON - NON-GROUPED
# SKIP
{
    "t":{"label":"Set G59 offsets in millimeters using JSON, grouped",
        "before":["g54","g0 x0 y0 z0"],
        "send":["{g55:{x:-20, y:-20, z:0}}"]},
    "r":{"status":0},
    "sr":{"g55":{"x": -20, "y": -20, "z": 10}}
}
#
{
    "t":{"label":"Set G59 offsets in millimeters using JSON, non-grouped",
        "before":["g54","g0 x0 y0 z0"],
        "send":["{g59x:11.5}","{g59y:6.6}","{g59z:-4.3}"]},
    "r":{"status":0},
    "sr":{"g55":{"x":0, "y":0, "z":0}}
}
#
{
    "t":{"label":"Read G59 position in mm",
        "send":["G21 G59"]},
    "r":{"status":0},
    "sr":{"posx":-11.5, "posy":-6.6, "posz":4.3}
}
#
{
    "t":{"label":"Read G59 position in inches",
        "send":["G20 G59"]},
    "r":{"status":0},
    "sr":{"posx":-0.4528, "posy":-0.2598, "posz":0.1693}
}
#
#
{
    "t":{"label":"Set G55 offsets in inches using JSON, non-grouped",
        "before":["g54","g0 x0 y0 z0", "g20"],
        "send":["{g55x:-1}","{g55y:-1}","{g55z:0.5}"]},
    "r":{"status":0},
    "sr":{"g55":{"x":0, "y":0, "z":0}}
}
#
{
    "t":{"label":"Read G55 position in mm",
        "send":["G21 G55"]},
    "r":{"status":0},
    "sr":{"posx":25.4, "posy":25.4, "posz":-12.7}
}
#
{
    "t":{"label":"Read G55 position in inches",
        "send":["G20 G55"]},
    "r":{"status":0},
    "sr":{"posx":1, "posy":1, "posz":0.5}
}
# EOF


{
    "t":{"label":"Set G59 offsets in millimeters",
        "before":["g21 g54","g0 x0 y0 z0"],
        "send":["G10 L20 P4 X25.4 Y25.4 Z-12.7"]},
    "r":{"status":0},
    "sr":{"posx":0, "posy":0, "posz":0}
}
#
{
    "t":{"label":"Read G57 position in mm",
        "send":["G21 G57"]},
    "r":{"status":0},
    "sr":{"posx":25.4, "posy":25.4, "posz":-12.7}
}
#
{
    "t":{"label":"Read G57 position in inches",
        "send":["G20 G57"]},
    "r":{"status":0},
    "sr":{"posx":1.0, "posy":1.0, "posz":-0.5}
}
#
{
    "t":{"label":"Set G54 (0,0,0) to G58 (1, 1, 0.05) in inches",
        "before":["g20 g54","g0 x0 y0 z0"],
        "send":["G10 L20 P4 X1 Y1 Z-0.5"]},
    "r":{"status":0},
    "sr":{"posx":0, "posy":0, "posz":0}
}
#
{
    "t":{"label":"Read G58 position in mm",
        "send":["G21 G58"]},
    "r":{"status":0},
    "sr":{"posx":25.4, "posy":25.4, "posz":-12.7}
}
#
{
    "t":{"label":"Read G58 position in inches",
        "send":["G20 G58"]},
    "r":{"status":0},
    "sr":{"posx":1.0, "posy":1.0, "posz":-0.5}
}
## EOF
# JSON COORDINATE SETTINGS
#
{
    "t":{"label":"Set test position as (0,0,0) in G55 using JSON commands",
        "before":["g54","g0 x0 y0 z0"],
        "send":["{g55:{x:-20, y:-20, z:0}}"]},
    "r":{"status":0},
    "sr":{"g55":{"x": -20, "y": -20, "z": 10}}
}
#
{
    "t":{"label":"Move to (0,0,0) in G55",
        "before":["g55"],
        "send":["g0 x0 y0 z0"]},
    "r":{"status":0},
    "sr":{"posx": -20, "posy": -20, "posz": 10}
}
# EOF


#
# TESTS
#
# Basic offset tests
#
{
    "t":{"label":"Move to test position in G54 coordinates",
        "send":["g0 x40 y40 z-20"]},
    "r":{"status":0},
    "sr":{"posx": 40, "posy": 40, "posz": -20}
}
#
{
    "t":{"label":"Return to origin in G54",
        "send":["g0 x0 y0 z0"]},
    "r":{"status":0},
    "sr":{"posx": 0, "posy": 0, "posz": 0}
}
#
{
    "t":{"label":"return to test position in G54",
        "send":["g0 x40 y40 z-20"]},
    "r":{"status":0},
    "sr":{"posx":40, "posy":40, "posz":-20}
}
# G10 L20 G55
{
    "t":{"label":"Set test position as (0,0,0) in G55",
        "send":["G10 L20 P2 X0 Y0 Z0"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Return to origin in G54",
        "send":["g0 x0 y0 z0"]},
    "r":{"status":0},
    "sr":{"posx": 0, "posy": 0, "posz": 0}
}
#
{
    "t":{"label":"Change to G55 and report position",
        "send":["G55"]},
    "r":{"status":0},
    "sr":{"posx": -40, "posy": -40, "posz": 20}
}
#
{
    "t":{"label":"Return to test position in G55",
        "before":["G55"],
        "send":["g0 x0 y0 z0"]},
    "r":{"status":0},
    "sr":{"posx": 0, "posy": 0, "posz": 0}
}
# G10 L2 G59
{
    "t":{"label":"Set test position as (20,20,-10) in G59",
        "send":["G10 L20 P6 X20 Y20 Z-10"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Change to G59 and report position",
        "send":["G59"]},
    "r":{"status":0},
    "sr":{"posx": 20, "posy": 20, "posz": -10}
}
#
{
    "t":{"label":"Return to origin in G59",
        "before":["G59"],
        "send":["g0 x-20 y-20 z10"]},
    "r":{"status":0},
    "sr":{"posx": -20, "posy": -20, "posz": 10}
}
# EOF
# JSON COORDINATE SETTINGS
#
{
    "t":{"label":"Set test position as (0,0,0) in G55 using JSON commands",
        "before":["g0 x0 y0 z0"],
        "send":["{g55:{x:-20, y:-20, z:0}}"]},
    "r":{"status":0},
    "sr":{"g55":{"x": -20, "y": -20, "z": 10}}
}
#
{
    "t":{"label":"Move to new position",
        "before":["g55"],
        "send":["g0 x0 y0 z0"]},
    "r":{"status":0},
    "sr":{"posx": -20, "posy": -20, "posz": 10}
}
# EOF



#
# G28 / G54 TEST
{
    "t":{"label":"Move to starting position in G54 coordinates",
        "before":["G21"],
        "send":["g0 x50 y50 z-30"]},
    "r":{"status":0},
    "sr":{"posx": 50, "posy": 50, "posz": -30}
}
#
{
    "t":{"label":"Save G28 starting position",
        "send":["G28.1"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Move to new position",
        "send":["g0 x60 y60 z-20"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Return to G28 starting position",
        "send":["G28"]},
    "r":{"status":0},
    "sr":{"posx": 50, "posy": 50, "posz": -30}
}
#
{
    "t":{"label":"Move to new position",
        "send":["g0 x60 y60 z-20"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Return to G28 starting position through Z-30",
        "send":["G28 X50 Y50"]},
    "r":{"status":0},
    "sr":{"posx": 50, "posy": 50, "posz": -30}
}
#
# G28 / G55 TEST SETUP
#
{
    "t":{"label":"Save current position as G28 starting position in G54",
        "send":["G54","G28.1"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Set G55 coordinates (1,1,1)",
        "send":["G10 L20 P2 X1 Y1 Z1"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Set to G55",
        "send":["G55"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Read G55 offsets",
        "send":["{G55:n}"]},
    "r":{"g55":{"x":49,"y":49,"z":-31,"a":0,"b":0,"c":0}, "status":0}
}
#
{
    "t":{"label":"Report starting position in G55 coordinates",
        "before":["G55"],
        "send":["{sr:n}"]},
    "r":{"status":0, "sr":{"posx":1.0,"posy":1.0,"posz":1.0}}
}
# Run G28 / G55 test
{
    "t":{"label":"Move to new position in G55",
        "before":["G55"],
        "send":["g0 x20 y20 z-10"]},
    "r":{"status":0},
    "sr":{"posx": 20, "posy": 20, "posz": -10}
}
#
{
    "t":{"label":"Return to G28 starting position",
        "before":["G55"],
        "send":["G28"]},
    "r":{"status":0},
    "sr":{"posx": 1, "posy": 1, "posz": 1}
}
# EOF
# G28 / G55 INCHES TEST
#
{
    "t":{"label":"Move to new position in G55 INCHES mode",
        "before":["G55","G20"],
        "send":["g0 x2 y1.5 z-0.5"]},
    "r":{"status":0},
    "sr":{"posx": 2, "posy": 1.5, "posz": -0.5}
}
#
{
    "t":{"label":"Return to G28 starting position while in G20 INCHES mode ",
        "before":["G55","G20"],
        "send":["G28"]},
    "r":{"status":0},
    "sr":{"posx": 0, "posy": 0, "posz": 0}
}

# EOF

#
# G28 / G55 TEST SETUP
#
{
    "t":{"label":"Save current position as G28 starting position in G54",
        "send":["G54","G28.1"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Set G55 coordinates (0,0,0)",
        "send":["G10 L20 P2 X0 Y0 Z0"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Set to G55",
        "send":["G55"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Report starting position in G55 coordinates",
        "before":["G55"],
        "send":["{sr:n}"]},
    "r":{"status":0, "sr":{"posx":0.0,"posy":0.0,"posz":0.0}}
}
#
# G28 / G55 TEST
#
{
    "t":{"label":"Move to new position in G55",
        "before":["G55"],
        "send":["g0 x20 y20 z-10"]},
    "r":{"status":0},
    "sr":{"posx": 20, "posy": 20, "posz": -10}
}
#
{
    "t":{"label":"Return to G28 starting position",
        "before":["G55"],
        "send":["G28"]},
    "r":{"status":0},
    "sr":{"posx": 0, "posy": 0, "posz": 0}
}
# EOF





#
# G28 / G55 TEST SETUP
#
{
    "t":{"label":"Save current position as G28 starting position in G54",
        "send":["G54","G28.1"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Set G55 coordinates (0,0,0)",
        "send":["G10 L20 P2 X0 Y0 Z0"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Set to G55",
        "send":["G55"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Report starting position in G55 coordinates",
        "before":["G55"],
        "send":["{sr:n}"]},
    "r":{"status":0, "sr":{"posx":0.0,"posy":0.0,"posz":0.0}}
}
#
# G28 / G55 TEST
#
{
    "t":{"label":"Move to new position in G55",
        "before":["G55"],
        "send":["g0 x20 y20 z-10"]},
    "r":{"status":0},
    "sr":{"posx": 20, "posy": 20, "posz": -10}
}
#
{
    "t":{"label":"Return to G28 starting position",
        "before":["G55"],
        "send":["G28"]},
    "r":{"status":0},
    "sr":{"posx": 0, "posy": 0, "posz": 0}
}
# EOF
# SKIP - not yet implemented
{
    "t":{"label":"Clear status report - THIS FUNCTION SHOULD ALWAYS RUN BY ITSELF",
        "send":["{srs:{clear:t}}"]},
    "r":{"status":0}
}
# SKIP - not yet implemented
{
    "t":{"label":"Set status report - RUNS AFTER CLEAR STATUS REPORT",
        "send":["{srs:{set:{line:t,posx:t,posy:t,posz:t,posa:t,feed:t,vel:t,unit:t,coor:t,dist:t,stat:t}}}"]},
    "r":{"status":0}
}
