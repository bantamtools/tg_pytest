################################################################################
#
#   planner.json - Planner tests
#
# Test assumptions:
#   Assumes a belt drive machine for XY or motors-only setup
#
{
  "before_all":{
    "label":"Setup for planner tests",
    "before":["{ej:1}", "{jv:5}", "{qv:0}", "{sv:2}", "{si:200}",
            "{sr:{in1:t, in2:t, in3:t, in4:t}",
            "{mt:0.5}",
            "{md:0}",
            "G21" ]
  }
}
#
{
  "before_each":{
    "label":"Reset coordinates",
    "after":["G28.3 X0"],
    "delay":0.100
  }
}
#
{
  "after_each":{
    "label":"Reset timeouts and disable motors",
    "after":["{mt:0.5}", "{md:0}", "g0x0y0"],
    "delay":0.100
  }
}
#
{
  "after_all":{
    "label":"Restore default settings",
    "after":["{defa:t}"]
  }
}
#
# TESTS BEGIN HERE
#
{
    "t":{"label":"Set anad read di1",
        "before":["{di1:{mo:0,ac:0,fn:0}}",
                  "{di2:{mo:0,ac:0,fn:0}}",
                  "{di3:{mo:0,ac:0,fn:0}}",
                  "{di4:{mo:0,ac:0,fn:0}}"],
        "send":["{sr:n}"]},
    "r":{"status":0, "sr":{"in1":false,"in2":false,"in3":false,"in4":false}
    }
}
# EOF
{
    "t":{"label":"Confirm that all motors are disabled",
        "send":["{sr:n}"]},
    "r":{"status":0, "sr":{"pwr1":0,"pwr2":0,"pwr3":0}
    }
}
#
{
    "t":{"label":"Enable all motors",
        "before":["{mt:5}"],
        "send":["{me:0}"]},
    "r":{"status":0},
    "sr":{"pwr1":0.4,"pwr2":0.4,"pwr3":0.4}
}
#
{
    "t":{"label":"Enable all motors incorrectly, with a NULL",
        "before":["{mt:5}"],
        "send":["{me:n}"]},
    "r":{"status":3}
}
#
{
    "t":{"label":"Disable all motors incorrectly, with a NULL",
        "before":["{mt:5}"],
        "send":["{md:n}"]},
    "r":{"status":3}
}
#
{
    "t":{"label":"Enable all motors then disable motor 1",
        "before":["{mt:5}"],
        "send":["{me:0}", "{md:1}"]},
    "r":{"status":0},
    "sr":{"pwr1":0,"pwr2":0.4,"pwr3":0.4}
}
#
{
    "t":{"label":"Disable all motors and make sure they stay that way",
        "before":["{1pm:0}", "{2pm:0}", "{3pm:0}"],
        "send":["{me:0}"]},
    "r":{"status":0},
    "sr":{"pwr1":0,"pwr2":0,"pwr3":0}
}
#
{
    "t":{"label":"Test ALWAYS ON mode",
        "before":["{1pm:1}", "{2pm:1}", "{3pm:1}", "{mt:0.1}"],
        "send":["{md:0}"]},
    "r":{"status":0},
    "sr":{"pwr1":0.4,"pwr2":0.4,"pwr3":0.4}
}
#
{
    "t":{"label":"Test POWERED IN CYCLE mode",
        "before":["{1pm:2}", "{2pm:2}", "{3pm:2}",
                  "{mt:4}"],
        "send":["G0 X10", "{sr:n}"]},
    "r":{"status":0}, "sr":{"pwr1":0.4,"pwr2":0.4,"pwr3":0.4}
}
#
{
    "t":{"label":"Test POWERED WHEN MOVING mode",
        "before":["{1pm:3}", "{2pm:3}", "{3pm:3}",
                  "{mt:4}"],
        "send":["G0 X10", "G0 Y10", "{sr:n}"]},
    "r":{"status":0}, "sr":{"pwr1":0.4,"pwr2":0.4,"pwr3":0}
}
#
# This one is complicated. Move slowly in X with a relatively fast timeout,
# then move slowly in Y allowing X to time out. Should work if the following hold:
#   t(SERIAL_TIMEOUT) < t(motor timeout) < t(movement in X or Y)
{
    "t":{"label":"Test POWERED WHEN MOVING mode with an in-cycle disable",
        "before":["{1pm:3}", "{2pm:3}", "{3pm:3}",
                  "{mt:1.5}"],
        "send":["G1 F500 X100", "G1 F500 Y100", "{sr:n}"]},
    "r":{"status":0}, "sr":{"pwr1":0,"pwr2":0.4,"pwr3":0}
}
#
