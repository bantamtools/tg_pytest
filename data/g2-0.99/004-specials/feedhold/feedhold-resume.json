################################################################################
#
#   feedhold-resume.json - tests for feedhold and resume with no spindle delays
#
# MACHINE SETUP
#   Prior to running this file:
#     Position X anywhere, this will become (0,0)
#     X must have > 100mm clearance in the positive direction
#     This position will be set (0,0,0) by G28.3 command
#
# TEST SETUP
#   Selects:
#     mm mode (G21)
#     absolute distance mode (G90)
#     units-per-minute feedrate mode (G94)
#
#   Sets centered point to be (0,0,0) in G55 coordinate system
#   Selects G55 coordinate system
#   Record current position as G28 home
#   Set feed rate for tests
#
# DEFAULTS (precision was 5 digits, reduced to 3)
{
    "defaults":{
        "fail":"hard",
        "delay":0.100,
        "precision":0.001
    }
}
# BEFORE AND AFTERS
{
    "before_all":{
        "label":"Reset default settings & cancel cycles - Always run this one by itself",
        "after":["g80","{defa:t}"]
    }
}
#
# SETUP ROUTINES
#
{
    "t":{"label":"Set Standard Gcode defaults - clear coordinate offsets",
        "send":["{ej:1}", "{jv:5}", "{tv:1}", "{qv:0}", "{sv:2}", "{si:200}",
                "G21","M30",
                "{ct:0.1}",
                "{sl:f}",
                "{lim:f}",
                "{coph:1}",
                "{spph:1}",
                "{spde:0}",
                "{zl:5}",
                "G21 G17 G49 G54 G80 G90 G91.1 G92.1 G94",
                "G10 L2 P1 X0 Y0 Z0",
                "G10 L2 P2 X0 Y0 Z0",
                "G10 L2 P3 X0 Y0 Z0",
                "G10 L2 P4 X0 Y0 Z0",
                "G10 L2 P5 X0 Y0 Z0",
                "G10 L2 P6 X0 Y0 Z0",
                "G55"
               ]},
    "r":{"status":0}
}
# Use old-style status report setup line
{
    "t":{"label":"Set status report - RUNS AFTER CLEAR STATUS REPORT",
        "send":["{sr:{com:t,cof:t,spc:t,sps:t,line:t,posx:t,posy:t,posz:t,feed:t,vel:t,unit:t,stat:t}}"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Set machine zero and return point",
        "send":["g28.3 x0 y0 z-95 a0", "G28.1"]},
    "r":{"status":0}
}
#
# TESTS START HERE
# Run a feedhold and resume cycle in a square move - MM
#
{
    "t":{"label":"Square move test in MM - start 4 moves and do a feedhold",
        "before":["~","g21 g0 x0 y0"],
        "send":["m3 m7 m8",
                "G1 X50.8 F3048",
                "G1 Y50.8",
                "G1 X0",
                "G1 Y0",
                "!"],
        "delay":0.1},
    "r":{"status":0},
    "sr":{"stat":6,"com":3,"cof":3,"spc":3}
}
#
# Run a feedhold and resume cycle in a square move - INCHES
#
{
    "t":{"label":"Square move test in inches - start 4 moves and do a feedhold",
        "before":["~","g20 g0 x0 y0"],
        "send":["m3 m7 m8",
                "G1 X2 F120",
                "G1 Y2",
                "G1 X0",
                "G1 Y0",
                "!"],
        "delay":0.1},
    "r":{"status":0},
    "sr":{"stat":6,"com":3,"cof":3,"spc":3}
}
#
{
    "t":{"label":"Resume from feedhold",
        "send":["~"],
        "after":["G21"]},
    "r":{"status":0},
    "sr":{"stat":3,"posx":0,"com":1,"cof":1,"spc":1}
}
#
#
# Run a feedhold and resume cycle on a single move
{
    "t":{"label":"Single move test to 30 - start movement and do a feedhold",
        "before":["g21 g0 x0 y0","~"],
        "send":["m3 m7 m8",
                "G1 F500 X30", "!"],
        "delay":0.5},
    "r":{"status":0},
    "sr":{"stat":6,"com":3,"cof":3,"spc":3}
}
#
{
    "t":{"label":"Resume from feedhold",
        "send":["~"]},
    "r":{"status":0},
    "sr":{"stat":3,"posx":30,"com":1,"cof":1,"spc":1}
}
#
# Run it again - back to zero, this time with movementin the feedhold
#
{
    "t":{"label":"Single move test to 0 - start movement and do a feedhold",
        "before":["~"],
        "send":["m3 m7 m8",
                "G1 F500 X0", "!"],
        "delay":0.75,
        "after":["g0 x2 y20"]},
    "r":{"status":0},
    "sr":{"stat":6,"com":3,"cof":3,"spc":3}
}
#
{
    "t":{"label":"Resume from feedhold",
        "send":["~"]},
    "r":{"status":0},
    "sr":{"stat":3,"posx":0,"com":1,"cof":1,"spc":1}
}
#
# Feedhold and resume an arc move
#
{
    "t":{"label":"Feedhold a CW 360 degree arc move",
         "before":["g0 x0 y0"],
         "send":["m3 m7 m8",
                 "G2 I25 F4000", "!"],
         "delay":0.75,
         "after":["g0 x10 y10"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Resume from feedhold",
        "send":["~"]},
    "r":{"status":0},
    "sr":{"stat":3,"posx":0,"posy":0,"com":1,"cof":1,"spc":1}
}
#
# Run a feedhold and resume cycle on a multi move sequence
#
{
    "t":{"label":"Start multi-move movement and do a feedhold",
        "before":["g0 x0 y0", "~"],
        "send":["m3 m7 m8",
                "g1 f200 x5",
                "x7.5 y7.7",
                "x8.9 y7.9",
                "x9.1 y8.2",
                "!"],
        "delay":0.5},
    "r":{"status":0},
    "sr":{"stat":6,"com":3,"cof":3,"spc":3}
}
#
{
    "t":{"label":"Resume from feedhold",
        "send":["~"]},
    "r":{"status":0},
    "sr":{"stat":3,"posx":9.1,"posy":8.2,"com":1,"cof":1,"spc":1}
}
