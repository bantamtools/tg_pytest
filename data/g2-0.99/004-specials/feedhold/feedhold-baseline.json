################################################################################
#
#   feedhold-baseline.json - basic feedhold tests
#
#   See feedhold-init file for machine setup instructions
#
# include 004-specials/feedhold/feedhold-init.json
#
# TESTS START HERE
#
# Try to enter a feedhold ! when not in a cycle
#
{
    "t":{"label":"Try to enter a feedhold ! when not in a cycle",
        "before":["g0 x1",
                  "g0 x0",
                  "m3 m7 m8"],
        "send":["!","{sr:n}"],
        "after":["m5 m9"]},
        "r":{"status":0},
        "sr":{"stat":3,"posx":0,"com":1,"cof":1,"spc":1}
}
#
# Try to end a feedhold ~ when not in a feedhold
#
{
    "t":{"label":"Try to end a feedhold ~ when not in a feedhold",
        "before":["g0 x0 m3 m7 m8"],
        "send":["~","{sr:n}"],
        "after":["m5 m9"]},
        "r":{"status":0},
        "sr":{"stat":3,"posx":0,"com":1,"cof":1,"spc":1}
}
#
# Try to end a feedhold % with queue flush when not in a feedhold
#
{
    "t":{"label":"Try to end a feedhold % with queue flush when not in a feedhold",
        "before":["g0 x0 m3 m7 m8"],
        "send":["%","{sr:n}"],
        "after":["m5 m9"]},
        "r":{"status":0},
        "sr":{"stat":3,"posx":0,"com":1,"cof":1,"spc":1}
}
#
# Enter feedhold and exit ~ immediately
#
{
    "t":{"label":"Enter feedhold and exit ~ immediately",
        "before":["g0 x0 m3 m7 m8"],
        "send":["G1 F1000 X30", "!~"],
        "after":["m5 m9"],
        "delay":0.75},
        "r":{"status":0},
        "sr":{"stat":3,"posx":30,"com":1,"cof":1,"spc":1}
}
#
# Enter feedhold and exit % immediately
#
{
    "t":{"label":"Enter feedhold and queue flush % immediately",
        "before":["g0 x0 m3 m7 m8"],
        "send":["G1 F1000 X30", "!%"],
        "after":["m5 m9"],
        "delay":0.75,
        "precision":1},
        "r":{"status":0},
        "sr":{"stat":3,"com":1,"cof":1,"spc":1}
}
#
# Test sequence !~%  This one is supposed to queue flush
#
{
    "t":{"label":"Test sequence !~%  This one is supposed to queue flush",
        "before":["g0 x0 m3 m7 m8"],
        "send":["G1 F1000 X30", "!~%"],
        "after":["m5 m9"],
        "delay":0.75,
        "precision":1},
        "r":{"status":0},
        "sr":{"stat":3,"com":1,"cof":1,"spc":1}
}
#
# Test sequence !%~  This one is supposed to queue flush
#
{
    "t":{"label":"Test sequence !%~  This one is supposed to queue flush",
        "before":["g0 x0 m3 m7 m8"],
        "send":["G1 F1000 X30", "!%~"],
        "after":["m5 m9"],
        "delay":0.75,
        "precision":1},
        "r":{"status":0},
        "sr":{"stat":3,"com":1,"cof":1,"spc":1}
}
#
# Run a bunch of commands in seqeunce
#
{
    "t":{"label":"FEEDHOLD TEST - hold, resume, hold-resume, hold, flush",
        "before":["g0 x0 m3 m7 m8"],
        "send":["G1 F1000 X40", "!", "~", "!~", "!", "%"],
        "delay":0.75},
    "r":{"status":0}
}
# EOF

# DEFAULTS
# SKIP
{
    "defaults":{
        "fail":"hard",
        "delay":0.100,
        "precision":0.001
    }
}
# BEFORE AND AFTERS
#
{
    "before_all":{
        "label":"Reset default settings & cancel cycles - Always run this one by itself",
        "after":["g80","{defa:t}"]
    }
}
# SETUP ROUTINES
{
    "t":{"label":"Set Standard Gcode defaults - clear coordinate offsets",
        "send":["{clear:n}",
                "{ej:1}", "{jv:5}", "{tv:1}", "{qv:0}", "{sv:2}", "{si:200}",
                "G21","M30",
                "{ct:0.1}",
                "{sl:f}",
                "{lim:f}",
                "{coph:1}",
                "{spph:1}",
                "{spde:0}",
                "{zl:5}",
                "G21 G17 G49 G54 G80 G90 G91.1 G92.1 G94",
                "G10 L20 P1 X0 Y0 Z0",
                "G10 L20 P2 X0 Y0 Z0",
                "G10 L20 P3 X0 Y0 Z0",
                "G10 L20 P4 X0 Y0 Z0",
                "G10 L20 P5 X0 Y0 Z0",
                "G10 L20 P6 X0 Y0 Z0",
                "g55"
               ]},
    "r":{"status":0}
}
# Use old-style status report setup line
{
    "t":{"label":"Set status report - RUNS AFTER CLEAR STATUS REPORT",
        "send":["{sr:{com:t,cof:t,spc:t,sps:t,line:t,posx:t,posy:t,posz:t,feed:t,vel:t,unit:t,stat:t}}"]},
    "r":{"status":0}
}
#
{
    "t":{"label":"Set machine zero and return point",
        "send":["g28.3 x0 y0 z-95 a0", "G28.1"]},
    "r":{"status":0}
}
#
